import{aK as N,aL as We,D as Te,aM as Qe,aN as Ne,aO as qe,aP as Je,aQ as Ae,aR as q,a as Pe,u as I,Y as _,Z as X,j as e,$ as z,a0 as x,a1 as h,a2 as j,a3 as g,I as p,a4 as f,aG as Ze,B as y,_ as H,aH as Ve,au as b,a6 as U,d as m,a8 as te,a9 as re,aa as ae,ab as oe,ac as ce,v as S,q as M,x as L,r as A,ae as en,ah as Ie,c as ie,A as nn,S as P,aI as sn,K as le,M as de,N as me,O as ue,Q as xe,R as he,U as je,V as ge,W as fe,i as Me,k as Fe,l as ke,m as Re,n as Z,a5 as tn,P as rn,e as an,f as Be,g as on,C as cn,at as ln,a7 as dn,ad as mn}from"./index-DwbuEFEH.js";import{P as un}from"./PageHeader-rIQwqtJA.js";import{T as xn,a as hn,b as Y,c as G}from"./tabs-BOsoG8kS.js";import{E as pe}from"./EmptyState-CVo49N0l.js";import{C as F,a as k,b as R,c as B,d as E,e as ye}from"./card-DdU8Mv6S.js";import{R as Ee,C as $e,X as Oe,Y as Le,T as Ye,a as Ge}from"./generateCategoricalChart-Bn-IwpwC.js";import{L as Ue,a as se}from"./LineChart-DVBxMQAG.js";function J(n,o){const s=N(n),i=N(o),a=s.getTime()-i.getTime();return a<0?-1:a>0?1:a}function jn(n){return We(n,Date.now())}function gn(n){return o=>{const i=(n?Math[n]:Math.trunc)(o);return i===0?0:i}}function fn(n,o){return+N(n)-+N(o)}function pn(n){const o=N(n);return o.setHours(23,59,59,999),o}function yn(n){const o=N(n);return+pn(o)==+Te(o)}function bn(n,o){const s=N(n),i=N(o),a=J(s,i),t=Math.abs(Qe(s,i));let c;if(t<1)c=0;else{s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-a*t);let r=J(s,i)===-a;yn(N(n))&&t===1&&J(n,i)===1&&(r=!1),c=a*(t-Number(r))}return c===0?0:c}function vn(n,o,s){const i=fn(n,o)/1e3;return gn(s==null?void 0:s.roundingMethod)(i)}function Dn(n,o,s){const i=qe(),a=(s==null?void 0:s.locale)??i.locale??Je,t=2520,c=J(n,o);if(isNaN(c))throw new RangeError("Invalid time value");const r=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:c});let l,d;c>0?(l=N(o),d=N(n)):(l=N(n),d=N(o));const C=vn(d,l),w=(Ne(d)-Ne(l))/1e3,u=Math.round((C-w)/60);let v;if(u<2)return s!=null&&s.includeSeconds?C<5?a.formatDistance("lessThanXSeconds",5,r):C<10?a.formatDistance("lessThanXSeconds",10,r):C<20?a.formatDistance("lessThanXSeconds",20,r):C<40?a.formatDistance("halfAMinute",0,r):C<60?a.formatDistance("lessThanXMinutes",1,r):a.formatDistance("xMinutes",1,r):u===0?a.formatDistance("lessThanXMinutes",1,r):a.formatDistance("xMinutes",u,r);if(u<45)return a.formatDistance("xMinutes",u,r);if(u<90)return a.formatDistance("aboutXHours",1,r);if(u<Ae){const D=Math.round(u/60);return a.formatDistance("aboutXHours",D,r)}else{if(u<t)return a.formatDistance("xDays",1,r);if(u<q){const D=Math.round(u/Ae);return a.formatDistance("xDays",D,r)}else if(u<q*2)return v=Math.round(u/q),a.formatDistance("aboutXMonths",v,r)}if(v=bn(d,l),v<12){const D=Math.round(u/q);return a.formatDistance("xMonths",D,r)}else{const D=v%12,T=Math.trunc(v/12);return D<3?a.formatDistance("aboutXYears",T,r):D<9?a.formatDistance("overXYears",T,r):a.formatDistance("almostXYears",T+1,r)}}function Sn(n,o){return Dn(n,jn(n),o)}const Nn=H({name:U().min(2,{message:"Budget name must be at least 2 characters."}),amount:b.number().positive({message:"Budget amount must be a positive number."}),tagIds:Ve(U()).min(1,{message:"Please select at least one tag."})}),An=({onSubmit:n,onCancel:o,initialValues:s,submitButtonText:i="Save"})=>{const{openTagDialog:a}=Pe(),t=I(()=>m.tags.orderBy("name").toArray(),[]),c=(t==null?void 0:t.map(d=>({value:d.id.toString(),label:d.name})))||[],r=_({resolver:X(Nn),defaultValues:{name:(s==null?void 0:s.name)||"",amount:(s==null?void 0:s.amount)||0,tagIds:(s==null?void 0:s.tagIds.map(d=>d.toString()))||[]}}),l=d=>{a({name:d})};return e.jsx(z,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(n),className:"space-y-4",children:[e.jsx(x,{control:r.control,name:"name",render:({field:d})=>e.jsxs(h,{children:[e.jsx(j,{children:"Budget Name"}),e.jsx(g,{children:e.jsx(p,{placeholder:"e.g., Monthly Groceries",...d,autoFocus:!0})}),e.jsx(f,{})]})}),e.jsx(x,{control:r.control,name:"amount",render:({field:d})=>e.jsxs(h,{children:[e.jsx(j,{children:"Monthly Amount"}),e.jsx(g,{children:e.jsx(p,{type:"number",step:"0.01",placeholder:"500.00",...d})}),e.jsx(f,{})]})}),e.jsx(x,{control:r.control,name:"tagIds",render:({field:d})=>e.jsxs(h,{children:[e.jsx(j,{children:"Tags to Include"}),e.jsx(g,{children:e.jsx(Ze,{options:c,selected:d.value||[],onChange:d.onChange,placeholder:"Select tags...",onAddNew:l})}),e.jsx(f,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:o,children:"Cancel"}),e.jsx(y,{type:"submit",children:i})]})]})})},Cn=({budget:n,isOpen:o,onClose:s})=>{const i=!!n,a=async t=>{try{const c={name:t.name,amount:t.amount,tagIds:t.tagIds.map(r=>parseInt(r,10)),period:"monthly"};i?(await m.budgets.update(n.id,c),S.info("Budget updated",{id:n.id,...c}),M("Budget updated successfully!")):(await m.budgets.add({...c,createdAt:new Date}),S.info("Budget added",c),M(`Budget "${t.name}" created successfully!`)),s()}catch(c){const r=i?"update":"add";S.error(`Failed to ${r} budget`,{error:c,values:t}),L("Failed to save budget. Does a budget with that name already exist?")}};return e.jsx(te,{open:o,onOpenChange:s,children:e.jsxs(re,{children:[e.jsxs(ae,{children:[e.jsxs(oe,{children:[i?"Edit":"Add New"," Budget"]}),e.jsx(ce,{children:i?"Update the details for this budget.":"Create a new budget to track spending based on tags."})]}),e.jsx(An,{onSubmit:a,onCancel:s,initialValues:n||void 0,submitButtonText:i?"Save Changes":"Add Budget"})]})})};var be="Progress",ve=100,[wn,as]=en(be),[Tn,Pn]=wn(be),_e=A.forwardRef((n,o)=>{const{__scopeProgress:s,value:i=null,max:a,getValueLabel:t=In,...c}=n;(a||a===0)&&!Ce(a)&&console.error(Mn(`${a}`,"Progress"));const r=Ce(a)?a:ve;i!==null&&!we(i,r)&&console.error(Fn(`${i}`,"Progress"));const l=we(i,r)?i:null,d=V(l)?t(l,r):void 0;return e.jsx(Tn,{scope:s,value:l,max:r,children:e.jsx(Ie.div,{"aria-valuemax":r,"aria-valuemin":0,"aria-valuenow":V(l)?l:void 0,"aria-valuetext":d,role:"progressbar","data-state":He(l,r),"data-value":l??void 0,"data-max":r,...c,ref:o})})});_e.displayName=be;var Xe="ProgressIndicator",ze=A.forwardRef((n,o)=>{const{__scopeProgress:s,...i}=n,a=Pn(Xe,s);return e.jsx(Ie.div,{"data-state":He(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...i,ref:o})});ze.displayName=Xe;function In(n,o){return`${Math.round(n/o*100)}%`}function He(n,o){return n==null?"indeterminate":n===o?"complete":"loading"}function V(n){return typeof n=="number"}function Ce(n){return V(n)&&!isNaN(n)&&n>0}function we(n,o){return V(n)&&!isNaN(n)&&n<=o&&n>=0}function Mn(n,o){return`Invalid prop \`max\` of value \`${n}\` supplied to \`${o}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${ve}\`.`}function Fn(n,o){return`Invalid prop \`value\` of value \`${n}\` supplied to \`${o}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${ve} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Ke=_e,kn=ze;const ee=A.forwardRef(({className:n,value:o,...s},i)=>e.jsx(Ke,{ref:i,className:ie("relative h-4 w-full overflow-hidden rounded-full bg-secondary",n),...s,children:e.jsx(kn,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(o||0)}%)`}})}));ee.displayName=Ke.displayName;const Rn=({budget:n,onEdit:o})=>{const s=I(()=>m.tags.where("id").anyOf(n.tagIds).toArray(),[n.tagIds]),i=I(async()=>{const t=new Date,c=nn(t),r=Te(t),d=(await m.transactions.where("date").between(c,r).and(w=>{var u;return w.amount<0&&((u=w.tags)==null?void 0:u.some(v=>n.tagIds.includes(v)))||!1}).toArray()).reduce((w,u)=>w+Math.abs(u.amount),0),C=n.amount>0?d/n.amount*100:0;return{totalSpent:d,progress:C}},[n.tagIds,n.amount]),a=async()=>{try{await m.budgets.delete(n.id),M("Budget deleted successfully."),S.info(`Budget ${n.id} deleted.`)}catch(t){L("Failed to delete budget."),S.error(`Failed to delete budget ${n.id}`,{error:t})}};return e.jsxs(F,{children:[e.jsxs(k,{children:[e.jsx(R,{children:n.name}),e.jsxs(B,{children:[n.amount.toLocaleString("en-US",{style:"currency",currency:"CAD"})," per month"]})]}),e.jsxs(E,{children:[i?e.jsxs(e.Fragment,{children:[e.jsx(ee,{value:i.progress,className:"mb-2"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.totalSpent.toLocaleString("en-US",{style:"currency",currency:"CAD"})," spent"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"h-4 w-full"}),e.jsx(P,{className:"h-5 w-1/2"})]}),e.jsx("div",{className:"flex flex-wrap gap-1 pt-4",children:s==null?void 0:s.map(t=>e.jsx(sn,{variant:"secondary",children:t.name},t.id))})]}),e.jsxs(ye,{className:"flex justify-end gap-2",children:[e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>o(n),children:[e.jsx("span",{className:"mr-1",children:"âœï¸"})," Edit"]}),e.jsxs(le,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",children:[e.jsx("span",{className:"mr-1",children:"ðŸ—‘ï¸"})," Delete"]})}),e.jsxs(me,{children:[e.jsxs(ue,{children:[e.jsx(xe,{children:"Are you sure?"}),e.jsxs(he,{children:['This will permanently delete the budget "',n.name,'".']})]}),e.jsxs(je,{children:[e.jsx(ge,{children:"Cancel"}),e.jsx(fe,{onClick:a,children:"Delete"})]})]})]})]})]})},Bn=()=>{const[n,o]=A.useState(!1),[s,i]=A.useState(null),a=I(()=>m.budgets.toArray()),t=r=>{i(r||null),o(!0)},c=()=>{i(null),o(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs(y,{onClick:()=>t(),children:[e.jsx("span",{className:"mr-2",children:"âž•"}),"Add Budget"]})}),a?a.length>0?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:a.map(r=>e.jsx(Rn,{budget:r,onEdit:t},r.id))}):e.jsx(pe,{icon:"ðŸŽ¯",title:"No Budgets Yet",description:"Create budgets based on tags to track your spending goals.",action:{text:"Create Your First Budget",onClick:()=>t()}}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:[...Array(3)].map((r,l)=>e.jsx(P,{className:"h-40 w-full"},l))}),e.jsx(Cn,{isOpen:n,onClose:c,budget:s})]})},En=H({name:U().min(2,{message:"Goal name must be at least 2 characters."}),targetAmount:b.number().positive({message:"Target amount must be positive."}),linkedAccountId:U().min(1,{message:"Please select an account."}),targetDate:ln().optional()}),$n=({onSubmit:n,onCancel:o,initialValues:s,submitButtonText:i="Save"})=>{const{openAddAccountDialog:a}=Pe(),t=I(()=>m.accounts.toArray(),[]),c=_({resolver:X(En),defaultValues:{name:(s==null?void 0:s.name)||"",targetAmount:(s==null?void 0:s.targetAmount)||0,linkedAccountId:(s==null?void 0:s.linkedAccountId.toString())||"",targetDate:s==null?void 0:s.targetDate}});return e.jsx(z,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(n),className:"space-y-4",children:[e.jsx(x,{control:c.control,name:"name",render:({field:r})=>e.jsxs(h,{children:[e.jsx(j,{children:"Goal Name"}),e.jsx(g,{children:e.jsx(p,{placeholder:"e.g., Vacation to Japan",...r,autoFocus:!0})}),e.jsx(f,{})]})}),e.jsx(x,{control:c.control,name:"targetAmount",render:({field:r})=>e.jsxs(h,{children:[e.jsx(j,{children:"Target Amount"}),e.jsx(g,{children:e.jsx(p,{type:"number",step:"0.01",placeholder:"5000.00",...r})}),e.jsx(f,{})]})}),e.jsx(x,{control:c.control,name:"linkedAccountId",render:({field:r})=>e.jsxs(h,{children:[e.jsx(j,{children:"Linked Savings Account"}),e.jsxs(Me,{onValueChange:l=>{l==="add-new"?a():r.onChange(l)},value:r.value,children:[e.jsx(g,{children:e.jsx(Fe,{children:e.jsx(ke,{placeholder:"Select an account"})})}),e.jsxs(Re,{children:[t==null?void 0:t.map(l=>e.jsx(Z,{value:l.id.toString(),children:l.name},l.id)),e.jsx(tn,{}),e.jsx(Z,{value:"add-new",children:e.jsx("span",{className:"font-medium text-primary",children:"âž• Add new account..."})})]})]}),e.jsx(f,{})]})}),e.jsx(x,{control:c.control,name:"targetDate",render:({field:r})=>e.jsxs(h,{children:[e.jsx(j,{children:"Target Date (Optional)"}),e.jsxs(rn,{children:[e.jsx(an,{asChild:!0,children:e.jsx(g,{children:e.jsxs(y,{variant:"outline",className:ie("w-full pl-3 text-left font-normal",!r.value&&"text-muted-foreground"),children:[r.value?Be(r.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx("span",{className:"ml-auto h-4 w-4 opacity-50",children:"ðŸ“…"})]})})}),e.jsx(on,{className:"w-auto p-0",align:"start",children:e.jsx(cn,{mode:"single",selected:r.value,onSelect:r.onChange})})]}),e.jsx(f,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:o,children:"Cancel"}),e.jsx(y,{type:"submit",children:i})]})]})})},On=({goal:n,isOpen:o,onClose:s})=>{const i=!!n,a=async t=>{try{const c={name:t.name,targetAmount:t.targetAmount,linkedAccountId:parseInt(t.linkedAccountId,10),targetDate:t.targetDate};i?(await m.goals.update(n.id,c),S.info("Goal updated",{id:n.id,...c}),M("Goal updated successfully!")):(await m.goals.add({...c,createdAt:new Date}),S.info("Goal added",c),M(`Goal "${t.name}" created successfully!`)),s()}catch(c){const r=i?"update":"add";S.error(`Failed to ${r} goal`,{error:c,values:t}),L("Failed to save goal. Does a goal with that name already exist?")}};return e.jsx(te,{open:o,onOpenChange:s,children:e.jsxs(re,{children:[e.jsxs(ae,{children:[e.jsxs(oe,{children:[i?"Edit":"Add New"," Goal"]}),e.jsx(ce,{children:i?"Update the details for this goal.":"Create a new goal to track your savings progress."})]}),e.jsx($n,{onSubmit:a,onCancel:s,initialValues:n||void 0,submitButtonText:i?"Save Changes":"Add Goal"})]})})},Ln=({goal:n,onEdit:o})=>{const s=I(async()=>{const t=await m.accounts.get(n.linkedAccountId);if(!t)return null;const r=(await m.transactions.where({accountId:t.id}).toArray()).reduce((l,d)=>l+d.amount,0);return{name:t.name,balance:r,currency:t.currency}},[n.linkedAccountId]),i=s?s.balance/n.targetAmount*100:0,a=async()=>{try{await m.goals.delete(n.id),M("Goal deleted successfully."),S.info(`Goal ${n.id} deleted.`)}catch(t){L("Failed to delete goal."),S.error(`Failed to delete goal ${n.id}`,{error:t})}};return e.jsxs(F,{children:[e.jsxs(k,{children:[e.jsx(R,{children:n.name}),e.jsxs(B,{children:["Target: ",n.targetAmount.toLocaleString("en-US",{style:"currency",currency:"CAD"})]})]}),e.jsx(E,{children:s?e.jsxs(e.Fragment,{children:[e.jsx(ee,{value:i,className:"mb-2"}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:[s.balance.toLocaleString("en-US",{style:"currency",currency:s.currency})," Saved"]}),e.jsxs("span",{children:[i.toFixed(0),"%"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Linked to: ",e.jsx("span",{className:"font-medium text-foreground",children:s.name})]}),n.targetDate&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Target: ",Be(n.targetDate,"MMM d, yyyy")," (",Sn(n.targetDate,{addSuffix:!0}),")"]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"h-4 w-full"}),e.jsx(P,{className:"h-5 w-1/2"})]})}),e.jsxs(ye,{className:"flex justify-end gap-2",children:[e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>o(n),children:[e.jsx("span",{className:"mr-1",children:"âœï¸"})," Edit"]}),e.jsxs(le,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",children:[e.jsx("span",{className:"mr-1",children:"ðŸ—‘ï¸"})," Delete"]})}),e.jsxs(me,{children:[e.jsxs(ue,{children:[e.jsx(xe,{children:"Are you sure?"}),e.jsxs(he,{children:['This will permanently delete the goal "',n.name,'".']})]}),e.jsxs(je,{children:[e.jsx(ge,{children:"Cancel"}),e.jsx(fe,{onClick:a,children:"Delete"})]})]})]})]})]})},Yn=()=>{const[n,o]=A.useState(!1),[s,i]=A.useState(null),a=I(()=>m.goals.orderBy("name").toArray()),t=r=>{i(r||null),o(!0)},c=()=>{i(null),o(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs(y,{onClick:()=>t(),children:[e.jsx("span",{className:"mr-2",children:"âž•"}),"Add Goal"]})}),a?a.length>0?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:a.map(r=>e.jsx(Ln,{goal:r,onEdit:t},r.id))}):e.jsx(pe,{icon:"ðŸŒ±",title:"No Goals Yet",description:"Create a goal and link it to a savings account to track your progress.",action:{text:"Create Your First Goal",onClick:()=>t()}}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:[...Array(3)].map((r,l)=>e.jsx(P,{className:"h-48 w-full"},l))}),e.jsx(On,{isOpen:n,onClose:c,goal:s})]})},Gn=H({name:U().min(2,{message:"Debt name must be at least 2 characters."}),initialAmount:b.number().positive({message:"Initial amount must be positive."}),interestRate:b.number().min(0,{message:"Interest rate cannot be negative."}),minimumPayment:b.number().min(0,{message:"Minimum payment cannot be negative."})}),Un=({onSubmit:n,onCancel:o,initialValues:s,submitButtonText:i="Save"})=>{const a=_({resolver:X(Gn),defaultValues:{name:(s==null?void 0:s.name)||"",initialAmount:(s==null?void 0:s.initialAmount)||0,interestRate:(s==null?void 0:s.interestRate)||0,minimumPayment:(s==null?void 0:s.minimumPayment)||0}});return e.jsx(z,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(n),className:"space-y-4",children:[e.jsx(x,{control:a.control,name:"name",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Debt Name"}),e.jsx(g,{children:e.jsx(p,{placeholder:"e.g., Car Loan",...t,autoFocus:!0})}),e.jsx(f,{})]})}),e.jsx(x,{control:a.control,name:"initialAmount",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Initial Amount"}),e.jsx(g,{children:e.jsx(p,{type:"number",step:"0.01",placeholder:"15000.00",...t})}),e.jsx(f,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:a.control,name:"interestRate",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Interest Rate (%)"}),e.jsx(g,{children:e.jsx(p,{type:"number",step:"0.01",placeholder:"5.99",...t})}),e.jsx(f,{})]})}),e.jsx(x,{control:a.control,name:"minimumPayment",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Minimum Payment"}),e.jsx(g,{children:e.jsx(p,{type:"number",step:"0.01",placeholder:"350.00",...t})}),e.jsx(f,{})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:o,children:"Cancel"}),e.jsx(y,{type:"submit",children:i})]})]})})},_n=({debt:n,isOpen:o,onClose:s})=>{const i=!!n,a=async t=>{try{if(i){const c={name:t.name,initialAmount:t.initialAmount,interestRate:t.interestRate,minimumPayment:t.minimumPayment};await m.debts.update(n.id,c),n.name!==t.name&&await m.tags.update(n.tagId,{name:`[Debt] ${t.name}`}),S.info("Debt updated",{id:n.id,...c}),M("Debt updated successfully!")}else await m.transaction("rw",m.tags,m.debts,async()=>{const c=await m.tags.add({name:`[Debt] ${t.name}`,createdAt:new Date}),r={name:t.name,initialAmount:t.initialAmount,interestRate:t.interestRate,minimumPayment:t.minimumPayment,tagId:c,createdAt:new Date};await m.debts.add(r),S.info("Debt added",r)}),M(`Debt "${t.name}" created successfully!`);s()}catch(c){const r=i?"update":"add";S.error(`Failed to ${r} debt`,{error:c,values:t}),L("Failed to save debt. Does a debt or tag with that name already exist?")}};return e.jsx(te,{open:o,onOpenChange:s,children:e.jsxs(re,{children:[e.jsxs(ae,{children:[e.jsxs(oe,{children:[i?"Edit":"Add New"," Debt"]}),e.jsx(ce,{children:i?"Update the details for this debt.":"Add a new loan or credit card debt to track your payoff progress."})]}),e.jsx(Un,{onSubmit:a,onCancel:s,initialValues:n||void 0,submitButtonText:i?"Save Changes":"Add Debt"})]})})},Xn=({debt:n,onEdit:o})=>{const s=I(async()=>{const t=(await m.transactions.where("tags").equals(n.tagId).toArray()).reduce((l,d)=>l+Math.abs(d.amount),0),c=n.initialAmount-t,r=n.initialAmount>0?t/n.initialAmount*100:0;return{totalPaid:t,currentBalance:c,progress:r}},[n.tagId,n.initialAmount]),i=async()=>{try{await m.transaction("rw",m.debts,m.tags,async()=>{await m.debts.delete(n.id),await m.tags.delete(n.tagId)}),M("Debt deleted successfully."),S.info(`Debt ${n.id} and tag ${n.tagId} deleted.`)}catch(a){L("Failed to delete debt."),S.error(`Failed to delete debt ${n.id}`,{error:a})}};return e.jsxs(F,{children:[e.jsxs(k,{children:[e.jsx(R,{children:n.name}),e.jsxs(B,{children:["Initial Amount: ",n.initialAmount.toLocaleString("en-US",{style:"currency",currency:"CAD"})]})]}),e.jsx(E,{children:s?e.jsxs(e.Fragment,{children:[e.jsx(ee,{value:s.progress,className:"mb-2"}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:[s.totalPaid.toLocaleString("en-US",{style:"currency",currency:"CAD"})," Paid"]}),e.jsxs("span",{children:[s.progress.toFixed(0),"%"]})]}),e.jsxs("p",{className:"text-sm font-medium mt-2",children:["Remaining Balance:",e.jsx("span",{className:"font-mono ml-2 text-base text-destructive",children:s.currentBalance.toLocaleString("en-US",{style:"currency",currency:"CAD"})})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"h-4 w-full"}),e.jsx(P,{className:"h-5 w-1/2"}),e.jsx(P,{className:"h-6 w-3/4"})]})}),e.jsxs(ye,{className:"flex justify-end gap-2",children:[e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>o(n),children:[e.jsx("span",{className:"mr-1",children:"âœï¸"})," Edit"]}),e.jsxs(le,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",children:[e.jsx("span",{className:"mr-1",children:"ðŸ—‘ï¸"})," Delete"]})}),e.jsxs(me,{children:[e.jsxs(ue,{children:[e.jsx(xe,{children:"Are you sure?"}),e.jsxs(he,{children:['This will permanently delete the debt "',n.name,'" and its associated payment tag.']})]}),e.jsxs(je,{children:[e.jsx(ge,{children:"Cancel"}),e.jsx(fe,{onClick:i,children:"Delete"})]})]})]})]})]})},zn=()=>{const[n,o]=A.useState(!1),[s,i]=A.useState(null),a=I(()=>m.debts.orderBy("name").toArray()),t=r=>{i(r||null),o(!0)},c=()=>{i(null),o(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs(y,{onClick:()=>t(),children:[e.jsx("span",{className:"mr-2",children:"âž•"}),"Add Debt"]})}),a?a.length>0?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:a.map(r=>e.jsx(Xn,{debt:r,onEdit:t},r.id))}):e.jsx(pe,{icon:"ðŸ’¸",title:"No Debts Yet",description:"Add a loan or credit card to track your payoff journey.",action:{text:"Add Your First Debt",onClick:()=>t()}}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:[...Array(3)].map((r,l)=>e.jsx(P,{className:"h-48 w-full"},l))}),e.jsx(_n,{isOpen:n,onClose:c,debt:s})]})},Hn=({data:n})=>e.jsx("div",{className:"w-full h-96",children:e.jsx(Ee,{width:"100%",height:"100%",children:e.jsxs(Ue,{data:n,children:[e.jsx($e,{strokeDasharray:"3 3"}),e.jsx(Oe,{dataKey:"age",name:"Age"}),e.jsx(Le,{tickFormatter:o=>`$${(o/1e3).toFixed(0)}k`}),e.jsx(Ye,{formatter:o=>o.toLocaleString("en-US",{style:"currency",currency:"CAD"})}),e.jsx(Ge,{}),e.jsx(se,{type:"monotone",dataKey:"balance",stroke:"#8884d8",name:"Savings Balance",strokeWidth:2,dot:!1})]})})}),Kn=H({currentAge:b.number().positive(),retirementAge:b.number().positive(),currentSavings:b.number().min(0),monthlyContribution:b.number().min(0),annualReturn:b.number().min(0)}),Wn=()=>{const[n,o]=A.useState(null),s=_({resolver:X(Kn),defaultValues:{currentAge:30,retirementAge:65,currentSavings:5e4,monthlyContribution:500,annualReturn:7}}),i=t=>{const{currentAge:c,retirementAge:r,currentSavings:l,monthlyContribution:d,annualReturn:C}=t,w=r-c,u=C/100/12,v=[];let D=l;v.push({year:0,age:c,balance:D});for(let T=1;T<=w;T++){for(let $=1;$<=12;$++)D=D*(1+u)+d;v.push({year:T,age:c+T,balance:D})}o(v)},a=A.useMemo(()=>{var t;return(t=n==null?void 0:n[n.length-1])==null?void 0:t.balance},[n]);return e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(F,{children:[e.jsxs(k,{children:[e.jsx(R,{children:"Retirement Calculator"}),e.jsx(B,{children:"Estimate your savings growth over time."})]}),e.jsx(E,{children:e.jsx(z,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(i),className:"space-y-4",children:[e.jsx(x,{control:s.control,name:"currentAge",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Current Age"}),e.jsx(g,{children:e.jsx(p,{type:"number",...t})}),e.jsx(f,{})]})}),e.jsx(x,{control:s.control,name:"retirementAge",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Retirement Age"}),e.jsx(g,{children:e.jsx(p,{type:"number",...t})}),e.jsx(f,{})]})}),e.jsx(x,{control:s.control,name:"currentSavings",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Current Savings"}),e.jsx(g,{children:e.jsx(p,{type:"number",...t})}),e.jsx(f,{})]})}),e.jsx(x,{control:s.control,name:"monthlyContribution",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Monthly Contribution"}),e.jsx(g,{children:e.jsx(p,{type:"number",...t})}),e.jsx(f,{})]})}),e.jsx(x,{control:s.control,name:"annualReturn",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:"Est. Annual Return (%)"}),e.jsx(g,{children:e.jsx(p,{type:"number",...t})}),e.jsx(f,{})]})}),e.jsx(y,{type:"submit",className:"w-full",children:"Calculate Projection"})]})})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(F,{children:[e.jsxs(k,{children:[e.jsx(R,{children:"Savings Projection"}),a!==void 0&&e.jsxs(B,{children:["Projected balance at age ",s.getValues("retirementAge"),":",e.jsxs("span",{className:"font-bold text-primary",children:[" ",a.toLocaleString("en-US",{style:"currency",currency:"CAD"})]})]})]}),e.jsx(E,{children:n?e.jsx(Hn,{data:n}):e.jsx("div",{className:"flex items-center justify-center h-96 text-muted-foreground",children:e.jsx("p",{children:'Enter your details and click "Calculate" to see your projection.'})})})]})})]})},Qn=({data:n})=>e.jsx("div",{className:"w-full h-96",children:e.jsx(Ee,{width:"100%",height:"100%",children:e.jsxs(Ue,{data:n,children:[e.jsx($e,{strokeDasharray:"3 3"}),e.jsx(Oe,{dataKey:"year",name:"Year"}),e.jsx(Le,{tickFormatter:o=>`$${(o/1e3).toFixed(0)}k`}),e.jsx(Ye,{formatter:o=>o.toLocaleString("en-US",{style:"currency",currency:"CAD"})}),e.jsx(Ge,{}),e.jsx(se,{type:"monotone",dataKey:"baseline",stroke:"#8884d8",name:"Baseline",strokeWidth:2,dot:!1}),e.jsx(se,{type:"monotone",dataKey:"scenario",stroke:"#82ca9d",name:"Scenario",strokeWidth:2,dot:!1})]})})}),qn=H({initialSavings:b.number().min(0),monthlyContribution:b.number().min(0),annualReturn:b.number().min(0),projectionYears:b.number().positive().max(50),scenarioType:dn(["one-time","recurring"]),scenarioAmount:b.number(),scenarioYearsFromNow:b.number().min(0),scenarioDuration:b.number().min(0).optional()}),Jn=()=>{const[n,o]=A.useState(null),s=_({resolver:X(qn),defaultValues:{initialSavings:1e4,monthlyContribution:500,annualReturn:7,projectionYears:20,scenarioType:"one-time",scenarioAmount:-2e4,scenarioYearsFromNow:5,scenarioDuration:1}}),i=s.watch("scenarioType"),a=c=>{const{initialSavings:r,monthlyContribution:l,annualReturn:d,projectionYears:C,scenarioType:w,scenarioAmount:u,scenarioYearsFromNow:v,scenarioDuration:D}=c,T=d/100/12,$=[];let K=r,W=r;$.push({year:0,baseline:K,scenario:W});for(let O=1;O<=C;O++){let ne=K,Q=W;O===v&&w==="one-time"&&(Q+=u);let De=l;w==="recurring"&&O>=v&&O<v+(D||0)&&(De+=u);for(let Se=1;Se<=12;Se++)ne=ne*(1+T)+l,Q=Q*(1+T)+De;K=ne,W=Q,$.push({year:O,baseline:K,scenario:W})}o($)},t=A.useMemo(()=>{if(!n)return null;const c=n[n.length-1].baseline,r=n[n.length-1].scenario,l=r-c;return{finalBaseline:c,finalScenario:r,difference:l}},[n]);return e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(F,{children:[e.jsxs(k,{children:[e.jsx(R,{children:"Scenario Planner"}),e.jsx(B,{children:"Model the financial impact of a major life event."})]}),e.jsx(E,{children:e.jsx(z,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(a),className:"space-y-4",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Baseline Projection"}),e.jsx(x,{control:s.control,name:"initialSavings",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Current Savings"}),e.jsx(g,{children:e.jsx(p,{type:"number",...c})}),e.jsx(f,{})]})}),e.jsx(x,{control:s.control,name:"monthlyContribution",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Monthly Contribution"}),e.jsx(g,{children:e.jsx(p,{type:"number",...c})}),e.jsx(f,{})]})}),e.jsx(x,{control:s.control,name:"annualReturn",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Est. Annual Return (%)"}),e.jsx(g,{children:e.jsx(p,{type:"number",...c})}),e.jsx(f,{})]})}),e.jsx(x,{control:s.control,name:"projectionYears",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Projection Years"}),e.jsx(g,{children:e.jsx(p,{type:"number",...c})}),e.jsx(f,{})]})}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground pt-4",children:"Scenario Event"}),e.jsx(x,{control:s.control,name:"scenarioType",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Event Type"}),e.jsxs(Me,{onValueChange:c.onChange,value:c.value,children:[e.jsx(g,{children:e.jsx(Fe,{children:e.jsx(ke,{})})}),e.jsxs(Re,{children:[e.jsx(Z,{value:"one-time",children:"One-Time Expense/Income"}),e.jsx(Z,{value:"recurring",children:"Recurring Change"})]})]}),e.jsx(f,{})]})}),e.jsx(x,{control:s.control,name:"scenarioAmount",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:i==="one-time"?"Amount (+/-)":"Monthly Change (+/-)"}),e.jsx(g,{children:e.jsx(p,{type:"number",...c})}),e.jsx(f,{})]})}),e.jsx(x,{control:s.control,name:"scenarioYearsFromNow",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Years From Now"}),e.jsx(g,{children:e.jsx(p,{type:"number",...c})}),e.jsx(f,{})]})}),i==="recurring"&&e.jsx(x,{control:s.control,name:"scenarioDuration",render:({field:c})=>e.jsxs(h,{children:[e.jsx(j,{children:"Duration (Years)"}),e.jsx(g,{children:e.jsx(p,{type:"number",...c})}),e.jsx(f,{})]})}),e.jsx(y,{type:"submit",className:"w-full",children:"Run Scenario"})]})})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(F,{children:[e.jsxs(k,{children:[e.jsx(R,{children:"Projection Comparison"}),t&&e.jsxs(B,{children:["After ",s.getValues("projectionYears")," years, this event results in a difference of",e.jsxs("span",{className:ie("font-bold",t.difference>=0?"text-green-600":"text-destructive"),children:[" ",t.difference.toLocaleString("en-US",{style:"currency",currency:"CAD"})]}),"."]})]}),e.jsx(E,{children:n?e.jsx(Qn,{data:n}):e.jsx("div",{className:"flex items-center justify-center h-96 text-muted-foreground",children:e.jsx("p",{children:'Enter your details and click "Run Scenario" to see your projection.'})})})]})})]})},os=()=>{const[n,o]=mn(),s=n.get("tab")||"budgets",i=a=>{o({tab:a})};return e.jsxs(e.Fragment,{children:[e.jsx(un,{title:"Planning ðŸŽ¯"}),e.jsxs(xn,{value:s,onValueChange:i,className:"w-full",children:[e.jsx("div",{className:"w-full overflow-x-auto pb-2",children:e.jsxs(hn,{children:[e.jsx(Y,{value:"budgets",children:"Budgets"}),e.jsx(Y,{value:"goals",children:"Goals"}),e.jsx(Y,{value:"debts",children:"Debts"}),e.jsx(Y,{value:"retirement",children:"Retirement"}),e.jsx(Y,{value:"scenarios",children:"Scenarios"})]})}),e.jsx(G,{value:"budgets",className:"mt-6",children:e.jsx(Bn,{})}),e.jsx(G,{value:"goals",className:"mt-6",children:e.jsx(Yn,{})}),e.jsx(G,{value:"debts",className:"mt-6",children:e.jsx(zn,{})}),e.jsx(G,{value:"retirement",className:"mt-6",children:e.jsx(Wn,{})}),e.jsx(G,{value:"scenarios",className:"mt-6",children:e.jsx(Jn,{})})]})]})};export{os as default};
