import{Y as E,Z as L,j as e,$ as B,a0 as p,a1 as y,a2 as f,a3 as v,I as b,a4 as N,B as j,_ as I,au as C,a6 as k,a8 as O,a9 as U,aa as $,ab as P,ac as Q,d,v as g,q as A,x as H,K as _,M,N as R,O as z,Q as Y,R as K,U as W,V as Z,W as G,r as D,u as x,S as u,ay as J}from"./index-DwbuEFEH.js";import{T as X}from"./TransactionList-DcqqMJeE.js";import{C as w,a as F,b as T,d as V,e as ee}from"./card-DdU8Mv6S.js";import{P as se}from"./PageHeader-rIQwqtJA.js";import{E as te}from"./EmptyState-CVo49N0l.js";import"./use-mobile-GAj-Qur4.js";const ae=I({name:k().min(2,{message:"Holding name must be at least 2 characters."}),ticker:k().optional(),quantity:C.number().positive({message:"Quantity must be a positive number."}),bookValue:C.number().positive({message:"Book value must be a positive number."})}),ne=({onSubmit:t,onCancel:a,initialValues:s,submitButtonText:r="Save"})=>{const n=E({resolver:L(ae),defaultValues:{name:(s==null?void 0:s.name)||"",ticker:(s==null?void 0:s.ticker)||"",quantity:(s==null?void 0:s.quantity)||0,bookValue:(s==null?void 0:s.bookValue)||0}});return e.jsx(B,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(t),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(p,{control:n.control,name:"name",render:({field:o})=>e.jsxs(y,{children:[e.jsx(f,{children:"Holding Name"}),e.jsx(v,{children:e.jsx(b,{placeholder:"e.g., Vanguard S&P 500",...o,autoFocus:!0})}),e.jsx(N,{})]})}),e.jsx(p,{control:n.control,name:"ticker",render:({field:o})=>e.jsxs(y,{children:[e.jsx(f,{children:"Ticker (Optional)"}),e.jsx(v,{children:e.jsx(b,{placeholder:"e.g., VFV",...o})}),e.jsx(N,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(p,{control:n.control,name:"quantity",render:({field:o})=>e.jsxs(y,{children:[e.jsx(f,{children:"Quantity"}),e.jsx(v,{children:e.jsx(b,{type:"number",step:"any",placeholder:"10",...o})}),e.jsx(N,{})]})}),e.jsx(p,{control:n.control,name:"bookValue",render:({field:o})=>e.jsxs(y,{children:[e.jsx(f,{children:"Total Book Value (Cost)"}),e.jsx(v,{children:e.jsx(b,{type:"number",step:"0.01",placeholder:"1000.00",...o})}),e.jsx(N,{})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),e.jsx(j,{type:"submit",children:r})]})]})})},re=({holding:t,accountId:a,isOpen:s,onClose:r})=>{const n=!!t,o=async l=>{try{const i={accountId:a,name:l.name,ticker:l.ticker,quantity:l.quantity,bookValue:l.bookValue};n?(await d.holdings.update(t.id,i),g.info("Holding updated",{id:t.id,...i}),A("Holding updated successfully!")):(await d.holdings.add({...i,createdAt:new Date}),g.info("Holding added",i),A(`Holding "${l.name}" created successfully!`)),r()}catch(i){const h=n?"update":"add";g.error(`Failed to ${h} holding`,{error:i,values:l}),H("Failed to save holding. Does a holding with that name already exist in this account?")}};return e.jsx(O,{open:s,onOpenChange:r,children:e.jsxs(U,{children:[e.jsxs($,{children:[e.jsxs(P,{children:[n?"Edit":"Add New"," Holding"]}),e.jsx(Q,{children:n?"Update the details for this holding.":"Add a new investment holding to this account."})]}),e.jsx(ne,{onSubmit:o,onCancel:r,initialValues:t||void 0,submitButtonText:n?"Save Changes":"Add Holding"})]})})},oe=({holding:t,onEdit:a,onDelete:s})=>{const r=t.quantity>0?t.bookValue/t.quantity:0;return e.jsxs(w,{children:[e.jsx(F,{className:"pb-2",children:e.jsxs(T,{className:"text-lg",children:[t.name," ",t.ticker&&`(${t.ticker})`]})}),e.jsxs(V,{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Quantity"}),e.jsx("p",{className:"font-medium",children:t.quantity.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Book Value"}),e.jsx("p",{className:"font-medium font-mono",children:t.bookValue.toLocaleString("en-US",{style:"currency",currency:"CAD"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Avg. Cost"}),e.jsx("p",{className:"font-medium font-mono",children:r.toLocaleString("en-US",{style:"currency",currency:"CAD"})})]})]}),e.jsxs(ee,{className:"flex justify-end gap-2 py-2",children:[e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>a(t),children:[e.jsx("span",{className:"mr-1",children:"âœï¸"})," Edit"]}),e.jsxs(_,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(j,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive",children:[e.jsx("span",{className:"mr-1",children:"ðŸ—‘ï¸"})," Delete"]})}),e.jsxs(R,{children:[e.jsxs(z,{children:[e.jsx(Y,{children:"Are you sure?"}),e.jsx(K,{children:"This will permanently delete this holding. This action cannot be undone."})]}),e.jsxs(W,{children:[e.jsx(Z,{children:"Cancel"}),e.jsx(G,{onClick:()=>s(t.id),children:"Delete"})]})]})]})]})]})},ce=({accountId:t})=>{const[a,s]=D.useState(!1),[r,n]=D.useState(null),o=x(()=>d.holdings.where({accountId:t}).toArray(),[t]),l=c=>{n(c||null),s(!0)},i=()=>{n(null),s(!1)},h=async c=>{try{await d.holdings.delete(c),A("Holding deleted successfully."),g.info(`Holding ${c} deleted.`)}catch(m){H("Failed to delete holding."),g.error(`Failed to delete holding ${c}`,{error:m})}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs(j,{onClick:()=>l(),children:[e.jsx("span",{className:"mr-2",children:"âž•"}),"Add Holding"]})}),o?o.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:o.map(c=>e.jsx(oe,{holding:c,onEdit:l,onDelete:h},c.id))}):e.jsx(te,{icon:"ðŸŒ±",title:"No Holdings Yet",description:"Add your first investment holding to this account to track its value.",action:{text:"Add Holding",onClick:()=>l()}}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:[...Array(3)].map((c,m)=>e.jsx(u,{className:"h-32 w-full"},m))}),e.jsx(re,{isOpen:a,onClose:i,holding:r,accountId:t})]})},S=["TFSA","RRSP","FHSA","investment_non_reg"],he=()=>{const{accountId:t}=J(),a=t?parseInt(t,10):void 0,s=x(()=>a?d.accounts.get(a):void 0,[a]),r=x(()=>a?d.transactions.where("accountId").equals(a).reverse().sortBy("date"):[],[a]),n=x(async()=>!a||!s?0:S.includes(s.type)?(await d.holdings.where({accountId:a}).toArray()).reduce((m,q)=>m+q.bookValue,0):r?r.reduce((c,m)=>c+m.amount,0):0,[a,s,r]),o=x(()=>d.categories.toArray(),[]),l=x(()=>d.tags.toArray(),[]),i=D.useMemo(()=>r||[],[r]);if(!s)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{className:"h-10 w-1/2"}),e.jsx(u,{className:"h-24 w-full"}),e.jsx(u,{className:"h-48 w-full"}),e.jsx(u,{className:"h-64 w-full"})]});const h=S.includes(s.type);return e.jsxs(e.Fragment,{children:[e.jsx(se,{title:s.name}),e.jsx(w,{className:"mb-6",children:e.jsx(F,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{children:e.jsx(T,{className:"text-lg text-muted-foreground",children:s.type.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase())})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Balance"}),e.jsx("p",{className:"text-2xl font-bold font-mono",children:n!==void 0?n.toLocaleString("en-US",{style:"currency",currency:s.currency}):e.jsx(u,{className:"h-8 w-32"})})]})]})})}),h?e.jsx(ce,{accountId:a}):e.jsx(X,{transactions:i,accounts:[s],categories:o||[],tags:l||[]})]})};export{he as default};
